<!DOCTYPE html>
<html>
  <head></head>
  <body>


<!-- This script tag bootstraps PyScript -->
<!-- <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" /> -->
<!-- <script defer src="https://pyscript.net/latest/pyscript.js"></script> -->

<script src="https://cdn.jsdelivr.net/pyodide/dev/full/pyodide.js"></script>

<!-- ------------------------------ -->
    

  
<!-- ------------------------------ -->

<label id="directions" style="display:block">A Dashboard in the browser using PyScript: plot data from a csv file</label>
	  
<br><br>
 
<button id="run" onclick="run()">Run</button>
    
<!-- View results -->
<div id="output" style="font-family:courier;font-size:24px;height:300px"></div>

<div id="pyplotdiv"><img id="pyplotfigure"/></div>
	
<script>
const outp = document.getElementById('output');

var file_url = '';


async function run() {

	return await get_desired_file_url()
		.then(async function(file_url) { await run_python();
			// str_encoded_img = await run_python();
				   // console.log('fig: ', fig);
				   // outp.innerHTML += str_encoded_img;
				   // document.getElementById("pyplotfigure").src = str_encoded_img;
				  })
		.catch(error => { console.log(error); });
}

	

async function get_desired_file_url() {
	
	const repoOwner = 'CodeSolutions2';
	const repoName = 'text_classification_w_labels';
	var url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents`;
  var desired_filename = "train_dataset0.csv"

	await fetch(url).then(res => res.json()).then(data => {
		    data.forEach(file => {
		      if (file.type === 'file' && file.name == desired_filename) {
            file_url = file.download_url;
		      }
		    });
		  }).catch(error => { outp.innerHTML += error; });
	
    	console.log('file_url: ', file_url);
	
	return file_url;
}

async function run_python() {
        let pyodide = await loadPyodide();
	await pyodide.loadPackage(["pandas"]);
        await pyodide.loadPackage(["matplotlib"]);

	var pyodide_browser_code = "from pyodide.http import open_url; import pandas as pd; import matplotlib.pyplot as plt; import io, base64; url_content = open_url("+`"${file_url}"`+"); df_text = pd.read_csv(url_content); x = [i for i in range(len(df_text))]; y = [len(df_text.iloc[i].value_counts()) for i in range(len(df_text))]; df = pd.DataFrame({'sentence_number': x, 'unique_words_per_sentence': y}); fig = plt.figure(figsize=(8,3)); plt.bar(x=df.sentence_number, height=df.unique_words_per_sentence, color='blue'); plt.show();"

	//ax = df.plot.bar('sentence_number', 'unique_words_per_sentence', rot=0);
	//buf = io.BytesIO(); fig.savefig(buf, format='png'); buf.seek(0); 'data:image/png;base64,'+base64.b64encode(buf.read()).decode('UTF-8')
	
	return pyodide.runPython(pyodide_browser_code);
}
  
</script>

    

  </body>
</html>
